{
  "metadata": {
    "id": "canonical-ruleset",
    "version": "2026-02-26.02",
    "description": "Canonical governance rule catalog used for policy and drift checks.",
    "generated_from": [
      ".agents-config/policies/agent-governance.json",
      ".agents-config/docs/AGENT_RULES.md"
    ],
    "lineage": {
      "policy_required_ids_sha256": "9803ce4b56484f98f595889664038e2c8a02a6ef6705a81010a84467a95f2c06",
      "policy_orchestrator_rules_sha256": "5d6bae98890860e9cc1118216be111b377a40c9e3553f4e457eac8e2d29888d2",
      "rules_doc_catalog_sha256": "8103e382041df5262ba97041894a18b729d25f551645383f307979f67247706c",
      "canonical_rules_sha256": "beb3cd9e71fac69316712aff33e214e983f93ac076a9144ba90233b92731fb05"
    }
  },
  "rules": [
    {
      "id": "rule_startup_read_order",
      "statement": "Follow startup read order and run session preflight before non-trivial implementation.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_context_index_usage",
      "statement": "Use `.agents-config/docs/CONTEXT_INDEX.json` as the machine-readable map for context lookup.",
      "category": ".agents-config/docs",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_execution_queue_required",
      "statement": "Maintain canonical machine-readable execution queue in `.agents/EXECUTION_QUEUE.json`.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_queue_plan_before_execution",
      "statement": "Plan all execution work into queue entries before changing any entry to active execution state.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_queue_single_source_of_truth",
      "statement": "Use `.agents/EXECUTION_QUEUE.json` as the only queue/scope authority across orchestrator and subagents.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_queue_scoped_context_read",
      "statement": "Read only queue fields/items relevant to the active feature/item scope to preserve context efficiency.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_queue_archive_on_complete",
      "statement": "Move completed task/feature work from hot queue into feature-sharded archive artifacts.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_plan_machine_contract_required",
      "statement": "Maintain machine-readable plan lifecycle + authoritative narrative context (including enforced pre-spec purpose/non-goals fields) in `PLAN.json` for each active/deferred/archived feature plan directory.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_plan_step_reference_required",
      "statement": "Require at least one concrete reference in every `PLAN.json` implementation step.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_plan_non_goals_status_gate",
      "statement": "Require non-empty `narrative.pre_spec_outline.non_goals` for policy-configured plan statuses (default: `ready`, `deferred`).",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_plan_placeholder_deliverables_forbidden",
      "statement": "Forbid placeholder implementation-step deliverables using policy deny patterns.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_plan_complete_step_summary_required",
      "statement": "For complete implementation steps, require non-empty completion-summary arrays for delivered work, touched files/functions/hooks, and verification/testing.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_plan_status_coherence_required",
      "statement": "Enforce policy-driven coherence between top-level plan status and implementation-step statuses.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_scope_tight_no_overbroad_refactor",
      "statement": "Keep changes narrowly scoped unless the user explicitly requests broad refactors.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_hybrid_machine_human_contract",
      "statement": "Use machine-readable contracts as authority with concise human nuance addenda when needed.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_policy_sync_required",
      "statement": "When process expectations change, update policy + enforcement + human docs together.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_continuity_required",
      "statement": "Read and maintain `.agents/CONTINUITY.md` as canonical continuity context.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_post_compaction_rebootstrap",
      "statement": "Treat compaction recovery as full startup and run preflight.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_repo_index_preflight_gate",
      "statement": "Require preflight index readiness checks (always re-index, then strict verify) before implementation starts.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_context_index_drift_guard",
      "statement": "Keep `.agents-config/docs/CONTEXT_INDEX.json` synchronized with policy/documentation contracts and fail checks on drift.",
      "category": ".agents-config/docs",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_canonical_ruleset_contract_required",
      "statement": "Maintain canonical rule IDs/statements in `.agents-config/contracts/rules/canonical-ruleset.json` with hash lineage tied to policy and rules docs.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_local_rule_overrides_contract_required",
      "statement": "Allow local-only override IDs only through `.agents-config/agent-overrides/rule-overrides.json`, validated against `.agents-config/agent-overrides/rule-overrides.schema.json`.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_managed_files_known_overrides_only",
      "statement": "Permit managed-file override payloads only for explicitly allowlisted entries (`allow_override=true`) and fail unknown `.agents-config/agent-overrides/**` payload files.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_managed_files_canonical_contract_required",
      "statement": "Keep managed workflow manifests (`.agents-config/agent-managed.json` and `.agents-config/tools/bootstrap/managed-files.template.json`) canonical with explicit `canonical_contract` defaults and authority modes.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_canonical_agents_root",
      "statement": "Treat `.agents` as the canonical project-local agent-context path; bootstrap defaults to external workfiles mode where `.agents` symlinks to `<agents-workfiles-path>/<project-id>` (default path `../agents-workfiles`), and local `.agents` mode is explicit via `--agents-mode local`.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_worktree_root_required",
      "statement": "Keep all non-primary Git worktrees under `../<repo-name>.worktrees`.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_agents_semantic_merge_required",
      "statement": "`.agents/**` is shared multi-session state; every `.agents/**` edit must be semantically merged against latest on-disk state.",
      "category": "execution",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_tdd_default",
      "statement": "Prefer true TDD and document deviations when strict TDD is impractical.",
      "category": "quality",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_coverage_default_100",
      "statement": "Treat 100% coverage as default bar unless user-approved exception exists.",
      "category": "quality",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_scope_completeness_gate",
      "statement": "Explicitly map outcomes to all in-scope user requests before closeout.",
      "category": "quality",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_feature_index_required",
      "statement": "Maintain `.agents-config/docs/FEATURE_INDEX.json` as the canonical machine-readable feature map.",
      "category": ".agents-config/docs",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_test_matrix_required",
      "statement": "Maintain `.agents-config/docs/TEST_MATRIX.md` as the canonical targeted test-command matrix.",
      "category": ".agents-config/docs",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_release_notes_template_required",
      "statement": "Enforce canonical release-notes template + generator workflow, section order, and plain-English non-jargon summaries through policy checks.",
      "category": "release",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_release_notes_changelog_source_required",
      "statement": "Treat `CHANGELOG.md` as release-notes source of truth and rotate `Unreleased` during `release:prepare`.",
      "category": "release",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_logging_contract_required",
      "statement": "Maintain `.agents-config/docs/LOGGING_STANDARDS.md` and enforce logging compliance checks across frontend/backend/python runtime code.",
      "category": "logging",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "orch_hybrid_instruction_contract",
      "statement": "Use a hybrid instruction contract: machine-readable payload plus concise human-readable intent/nuance.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_scope_tightness",
      "statement": "Keep delegated work and resulting diffs tightly scoped to the user request; no overbroad refactors unless explicitly requested.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_machine_payload_authoritative",
      "statement": "Treat the machine-readable payload as authoritative for execution; resolve conflicts with prose before proceeding.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_delegate_substantive_work",
      "statement": "Preserve orchestrator context by delegating substantive discovery/investigation and implementation tasks whenever delegation is feasible.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_operator_subagent_default",
      "statement": "Whenever possible, delegate discovery and implementation work to subagents; direct single-agent execution is restricted to trivial coordination/meta tasks.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_subagent_delegation_required_when_possible",
      "statement": "Treat subagent delegation as mandatory whenever delegation is feasible, including investigation/discovery and implementation execution.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_human_nuance_addendum",
      "statement": "When nuances are not fully captured by machine-readable fields, include concise human-language addenda.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_atomic_task_delegation",
      "statement": "Delegate work in strict atomic task slices so each subagent receives a concrete objective with explicit inputs, acceptance criteria, and verification steps.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_dual_channel_result_envelope",
      "statement": "Require subagent output in two channels: machine-readable result envelope plus concise human-readable summary.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_orchestrator_coordination_only",
      "statement": "Limit orchestrator direct execution to coordination/meta tasks; if delegation is infeasible, record explicit rationale first.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_release_idle_subagents_required",
      "statement": "Release/close subagents immediately once they are complete or no longer actively executing delegated work.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_default_cli_routing",
      "statement": "Default subagent orchestration mapping is Codex agents via `codex` CLI and Claude agents via `claude` CLI unless user-overridden.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": true,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_unconfirmed_unknowns",
      "statement": "Mark unknowns explicitly as `UNCONFIRMED` and fail fast on missing required fields.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_atomic_single_objective_scope",
      "statement": "Each delegated subagent task must target exactly one concrete objective with explicit atomic_scope boundaries; split multi-objective requests into separate tasks.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_single_orchestrator_authority",
      "statement": "Use exactly one orchestrator context owner per session; subagents execute delegated work and must not recursively orchestrate.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_concise_subagent_briefs",
      "statement": "Keep subagent machine payloads and human addenda concise, bounded by configured verbosity budgets.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_spec_refined_plan_verbosity",
      "statement": "Apply concise verbosity budgets across spec outline, refined spec, and detailed implementation plan artifacts.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_codex_model_default",
      "statement": "Default model routing is role/risk-based: orchestrator uses `gpt-5.3-codex` with `xhigh`, subagents use `gpt-5.3-codex` with `high`, and Spark is reserved for low-risk loops with explicit verification commands.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": true,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "orch_claude_model_default",
      "statement": "Claude model routing is role/risk-based: orchestrator uses `claude-opus-4-6`, subagents use `claude-opus-4-6` (or `claude-sonnet-4-6` for lighter tasks), and `claude-haiku-4-5` is reserved for low-risk loops. Claude orchestrators may delegate to Codex subagents via `codex exec`.",
      "category": "orchestration",
      "severity": "error",
      "overrideable": false,
      "source": "policy.orchestratorSubagent.rules"
    },
    {
      "id": "rule_route_map_required",
      "statement": "Maintain `.agents-config/docs/ROUTE_MAP.md` as the canonical generated backend/frontend route map.",
      "category": ".agents-config/docs",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_domain_readmes_required",
      "statement": "Maintain per-domain start-here READMEs in `backend/src/routes`, `backend/src/services`, and `frontend/features/*`.",
      "category": ".agents-config/docs",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_jsdoc_coverage_required",
      "statement": "Maintain `.agents-config/docs/JSDOC_COVERAGE.md` as the generated exported-symbol documentation drift tracker.",
      "category": ".agents-config/docs",
      "severity": "error",
      "overrideable": true,
      "source": "docs.ruleCatalog"
    },
    {
      "id": "rule_openapi_endpoint_docs_required",
      "statement": "Maintain `.agents-config/docs/OPENAPI_COVERAGE.md` as the generated OpenAPI endpoint/spec coverage drift tracker.",
      "category": "governance",
      "severity": "error",
      "overrideable": false,
      "source": "docs.ruleCatalog"
    }
  ]
}
