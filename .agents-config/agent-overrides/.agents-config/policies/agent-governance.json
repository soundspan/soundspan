{
  "metadata": {
    "id": "soundspan-agent-governance",
    "version": "2026-02-26.02",
    "description": "Executable governance checks for reusable multi-repository agent workflows."
  },
  "contracts": {
    "documentationModel": {
      "bootstrapFile": "AGENTS.md",
      "humanRulesFile": ".agents-config/docs/AGENT_RULES.md",
      "humanContextFile": ".agents-config/docs/AGENT_CONTEXT.md",
      "contextIndexFile": ".agents-config/docs/CONTEXT_INDEX.json",
      "machinePolicyFile": ".agents-config/policies/agent-governance.json",
      "enforcementScript": ".agents-config/scripts/enforce-agent-policies.mjs",
      "sessionPreflightScript": ".agents-config/scripts/agent-session-preflight.mjs",
      "sessionPreflightCommand": "npm run agent:preflight",
      "startupReadOrder": [
        "AGENTS.md",
        ".agents-config/docs/AGENT_RULES.md",
        ".agents-config/docs/CONTEXT_INDEX.json",
        ".agents-config/docs/AGENT_CONTEXT.md",
        ".agents/EXECUTION_QUEUE.json",
        ".agents/CONTINUITY.md"
      ],
      "precedenceOrder": [
        "user_instruction",
        "machine_policy",
        "human_rules",
        "human_context"
      ]
    },
    "contextIndex": {
      "indexFile": ".agents-config/docs/CONTEXT_INDEX.json",
      "requiredTopLevelKeys": [
        "metadata",
        "startupReadOrder",
        "primaryContracts",
        "sessionArtifacts",
        "ruleCatalog",
        "canonicalRules",
        "managedFilesCanonical",
        "orchestratorSubagent",
        "rulesSections",
        "contextSections",
        "commands"
      ],
      "requiredStartupReadOrder": [
        "AGENTS.md",
        ".agents-config/docs/AGENT_RULES.md",
        ".agents-config/docs/CONTEXT_INDEX.json",
        ".agents-config/docs/AGENT_CONTEXT.md",
        ".agents/EXECUTION_QUEUE.json",
        ".agents/CONTINUITY.md"
      ],
      "requiredCommandKeys": [
        "policyCheck",
        "sessionPreflight",
        "agentPayloadStub",
        "queueLifecycle",
        "indexBuild",
        "indexVerify",
        "featureIndexVerify",
        "routeMapGenerate",
        "routeMapVerify",
        "domainReadmesGenerate",
        "domainReadmesVerify",
        "jsdocCoverageGenerate",
        "jsdocCoverageVerify",
        "openapiCoverageGenerate",
        "openapiCoverageVerify",
        "loggingComplianceGenerate",
        "loggingComplianceVerify",
        "indexQueryStrictFresh",
        "releasePrepare",
        "releaseVerify",
        "releaseNotes",
        "changelogFile",
        "featureIndexFile",
        "testMatrixFile",
        "routeMapFile",
        "jsdocCoverageFile",
        "openapiCoverageFile",
        "loggingStandardsFile",
        "routesReadmeFile",
        "servicesReadmeFile",
        "frontendFeaturesReadmeFile",
        "canonicalRulesVerify",
        "canonicalRulesSync",
        "agentManaged",
        "agentManagedFix",
        "templateImpactCheck",
        "policyCheckCi",
        "releaseContractCheck"
      ]
    },
    "releaseNotes": {
      "sourceOfTruthFile": "CHANGELOG.md",
      "unreleasedSectionHeading": "## [Unreleased]",
      "requiredChangelogSubsections": [
        "### Added",
        "### Changed",
        "### Fixed"
      ],
      "prepareScript": ".agents-config/scripts/release-version-sync.mjs",
      "prepareNpmScriptName": "release:prepare",
      "prepareNpmScriptCommand": "node .agents-config/scripts/release-version-sync.mjs --write",
      "prepareCommandExample": "npm run release:prepare -- --version <X.Y.Z>",
      "prepareRotatesUnreleased": true,
      "templateFile": ".agents-config/docs/RELEASE_NOTES_TEMPLATE.md",
      "generatorScript": ".agents-config/scripts/generate-release-notes.mjs",
      "npmScriptName": "release:notes",
      "npmScriptCommand": "node .agents-config/scripts/generate-release-notes.mjs",
      "commandExample": "npm run release:notes -- --version <X.Y.Z> --from <tag> [--to <ref>] [--output <path>]",
      "plainEnglishSummariesRequired": true,
      "requiredSections": [
        "## Release Summary",
        "## Fixed",
        "## Added",
        "## Changed",
        "## Admin/Operations",
        "## Deployment and Distribution",
        "## Breaking Changes",
        "## Known Issues",
        "## Compatibility and Migration",
        "## Full Changelog"
      ],
      "requiredTemplateTokens": [
        "{{VERSION}}",
        "{{RELEASE_DATE}}",
        "{{COMPARE_URL}}",
        "{{RELEASE_SUMMARY}}",
        "{{FIXED_ITEMS}}",
        "{{ADDED_ITEMS}}",
        "{{CHANGED_ITEMS}}",
        "{{ADMIN_ITEMS}}",
        "{{BREAKING_ITEMS}}",
        "{{KNOWN_ISSUES}}",
        "{{COMPATIBILITY_AND_MIGRATION}}",
        "{{FULL_CHANGELOG_URL}}"
      ],
      "helmRepoName": "soundspan",
      "helmRepoUrl": "https://soundspan.github.io/soundspan",
      "helmChartName": "soundspan",
      "helmChartReference": "soundspan/soundspan",
      "helmReleaseName": "soundspan"
    },
    "featureIndex": {
      "file": ".agents-config/docs/FEATURE_INDEX.json",
      "requiredMetadataId": "soundspan-feature-index",
      "requiredTopLevelKeys": [
        "metadata",
        "sources",
        "coverage",
        "features"
      ],
      "requiredMetadataKeys": [
        "id",
        "version",
        "description",
        "last_updated",
        "update_expectation"
      ],
      "requiredCoverageKeys": [
        "frontend_feature_dirs",
        "verification_rules"
      ],
      "requiredFeatureFields": [
        "id",
        "name",
        "summary",
        "update_expectation",
        "frontend",
        "backend",
        "tests",
        ".agents-config/docs"
      ],
      "requiredFrontendFields": [
        "feature_dirs",
        "routes",
        "primary_files"
      ],
      "requiredBackendFields": [
        "routes",
        "services"
      ],
      "requiredTestsFields": [
        "targeted_commands",
        "primary_specs"
      ],
      "frontendFeatureRoot": "frontend/features",
      "enforceFrontendFeatureCoverage": true,
      "profiles": [
        "node-web"
      ],
      "enabled": true
    },
    "testMatrix": {
      "file": ".agents-config/docs/TEST_MATRIX.md",
      "requiredSections": [
        "# Test Matrix",
        "## Usage Rule",
        "## Fast Commands",
        "## Feature-to-Test Map",
        "## Update Triggers",
        "## Verification Workflow"
      ],
      "profiles": [
        "node-web"
      ],
      "enabled": true
    },
    "sessionArtifacts": {
      "executionQueueFile": ".agents/EXECUTION_QUEUE.json",
      "sessionBriefJsonFile": ".agents/SESSION_BRIEF.json",
      "continuityFile": ".agents/CONTINUITY.md",
      "archiveRoot": ".agents/archives",
      "archiveIndexFile": ".agents/EXECUTION_ARCHIVE_INDEX.json",
      "archiveShardBy": "feature_id",
      "archiveFormat": "jsonl",
      "archiveReadPolicy": "cold_lookup_only",
      "retiredArtifacts": [
        ".agents/ACTIVE_SCOPE.json",
        ".agents/UNRESOLVED_QUEUE.json"
      ],
      "plansRoot": ".agents/plans",
      "planRoots": [
        ".agents/plans/current",
        ".agents/plans/deferred",
        ".agents/plans/archived"
      ],
      "planQueueSyncEnabled": true,
      "planQueueSyncPlanFileName": "PLAN.json",
      "planQueueSyncRoots": [
        ".agents/plans/current",
        ".agents/plans/deferred"
      ],
      "planQueueSyncStateByRoot": {
        ".agents/plans/current": "pending",
        ".agents/plans/deferred": "deferred"
      },
      "planQueueSyncDefaultOwner": "orchestrator",
      "planQueueSyncDefaultItemType": "task",
      "planQueueSyncDefaultSubscope": "plan-track",
      "planMachineContractEnabled": true,
      "planMachineFileName": "PLAN.json",
      "planMachineSchemaVersion": "1.0",
      "planMachineRoots": [
        ".agents/plans/current",
        ".agents/plans/deferred",
        ".agents/plans/archived"
      ],
      "planMachineRequiredTopLevelFields": [
        "schema_version",
        "feature_id",
        "feature_title",
        "plan_ref",
        "status",
        "updated_at",
        "planning_stages",
        "narrative",
        "subagent"
      ],
      "planMachineRequiredPlanningStages": [
        "spec_outline",
        "refined_spec",
        "implementation_plan"
      ],
      "planMachineRequiredNarrativeFields": [
        "spec_outline",
        "refined_spec",
        "implementation_plan"
      ],
      "planMachinePreSpecOutlineRequiredFields": [
        "purpose_goals",
        "non_goals"
      ],
      "planMachineStatusesRequiringNonEmptyPreSpecNonGoals": [
        "ready",
        "deferred"
      ],
      "planMachineStatusesRequiringNarrativeContent": [
        "in_progress",
        "complete"
      ],
      "planMachineNarrativeMinLength": 24,
      "planMachinePreSpecOutlineMinLength": 24,
      "planMachineNarrativeMinSteps": 1,
      "planMachineSpecOutlineListFieldName": "full_spec_outline",
      "planMachineRefinedSpecListFieldName": "full_refined_spec",
      "planMachineSpecOutlineEntryRequiredFields": [
        "id",
        "objective",
        "deliverable",
        "acceptance_criteria",
        "references"
      ],
      "planMachineRefinedSpecEntryRequiredFields": [
        "id",
        "decision",
        "rationale",
        "acceptance_criteria",
        "references"
      ],
      "planMachineStatusesRequiringSpecOutlineEntries": [
        "in_progress",
        "complete"
      ],
      "planMachineStatusesRequiringRefinedSpecEntries": [
        "in_progress",
        "complete"
      ],
      "planMachineSpecOutlineMinEntries": 1,
      "planMachineRefinedSpecMinEntries": 1,
      "planMachineImplementationStepsFieldName": "steps",
      "planMachineAllowedNarrativeStepStatuses": [
        "pending",
        "in_progress",
        "complete",
        "blocked"
      ],
      "planMachineNarrativeStepRequiredFields": [
        "status",
        "deliverable",
        "acceptance_criteria",
        "references",
        "completion_summary"
      ],
      "planMachineNarrativeStepOptionalFields": [],
      "planMachineImplementationStepDeliverableDenyPatterns": [
        "^\\s*(todo|tbd|placeholder|n\\/?a|none|unknown)\\s*$",
        "^\\s*(step|task|item|deliverable)\\s*\\d+\\s*$",
        "^\\s*<[^>]+>\\s*$"
      ],
      "planMachineImplementationStepAcceptanceCriteriaMinCount": 1,
      "planMachineStepStatusesRequiringAcceptanceCriteria": [
        "in_progress",
        "complete"
      ],
      "planMachineStepStatusesRequiringNonEmptyCompletionSummary": [
        "complete"
      ],
      "planMachineImplementationCompletionSummaryRequiredFields": [
        "delivered",
        "files_functions_hooks_touched",
        "verification_testing"
      ],
      "planMachineAllowedPlanningStageStates": [
        "pending",
        "in_progress",
        "complete"
      ],
      "planMachineAllowedSubagentRequirements": [
        "required",
        "recommended",
        "optional",
        "none"
      ],
      "planMachineRequiredSubagentFields": [
        "requirement",
        "primary_agent",
        "execution_agents",
        "last_executor"
      ],
      "planMachineStatusesRequiringLastExecutor": [
        "in_progress",
        "complete"
      ],
      "planMachineAllowedStatusByRoot": {
        ".agents/plans/current": [
          "draft",
          "ready",
          "in_progress",
          "blocked",
          "complete"
        ],
        ".agents/plans/deferred": [
          "deferred"
        ],
        ".agents/plans/archived": [
          "complete",
          "archived"
        ]
      },
      "planMachineStatusCoherence": {
        "requireInProgressPlanStatusWhenAnyStepInProgress": true,
        "statusesRequiringAllImplementationStepsComplete": [
          "complete"
        ],
        "statusesForbiddingInProgressImplementationSteps": [
          "deferred"
        ]
      },
      "archivedPlanSyncEnabled": true,
      "archivedPlanRoot": ".agents/plans/archived",
      "archivedPlanFileName": "PLAN.json",
      "archivedPlanCanonicalHandoffFileName": "HANDOFF.md",
      "archivedPlanLegacyHandoffFileNames": [
        "LLM_SESSION_HANDOFF.md"
      ],
      "archivedPlanArchiveKeyPrefix": "feature-plan:",
      "archivedPlanIndexKind": "feature",
      "stalePlanReferenceCheckEnabled": true,
      "stalePlanReferenceFailureMode": "fail",
      "stalePlanReferenceScanRoots": [
        ".agents/plans"
      ],
      "repositoryIndexPreflight": {
        "enabled": true,
        "buildIfMissing": true,
        "reindexBeforeVerify": true,
        "verifyStrict": true,
        "failureMode": "fail",
        "closeoutVerifyIfPossible": true
      },
      "sessionBriefRequiredFields": [
        "generated_at",
        "policy",
        "scope",
        "queue_file",
        "archive_index_file",
        "index_readiness",
        "queue_read_contract",
        "queue_overview",
        "startup_attestation",
        "queue_quality_gate",
        "next_actions"
      ],
      "sessionBriefFreshnessHoursWarning": 24,
      "scopeReadRequiredTopLevelFields": [
        "state",
        "feature_id",
        "task_id",
        "objective",
        "last_updated",
        "updated_at",
        "in_scope",
        "out_of_scope",
        "open_questions"
      ],
      "scopeReadItemSelectorFields": [
        "id",
        "plan_ref",
        "owner",
        "depends_on"
      ],
      "maxScopedItemsPerRead": 25,
      "requiredExecutionQueueFields": [
        "version",
        "created_at",
        "last_updated",
        "updated_at",
        "state",
        "feature_id",
        "task_id",
        "objective",
        "in_scope",
        "out_of_scope",
        "acceptance_criteria",
        "constraints",
        "references",
        "open_questions",
        "deferred_reason",
        "cancel_reason",
        "items"
      ],
      "requiredQueueItemFields": [
        "id",
        "idempotency_key",
        "feature_id",
        "subscope",
        "title",
        "type",
        "state",
        "created_at",
        "updated_at",
        "planned_at",
        "owner",
        "acceptance_criteria",
        "constraints",
        "references",
        "depends_on",
        "plan_ref",
        "execution_started_at",
        "completed_at",
        "claimed_by",
        "claimed_at",
        "lease_expires_at",
        "attempt_count",
        "last_attempt_at",
        "last_error",
        "retry_after",
        "outputs",
        "evidence",
        "resolution_summary",
        "deferred_reason",
        "cancel_reason"
      ],
      "allowedQueueItemTypes": [
        "task",
        "question",
        "decision"
      ],
      "allowedQueueStates": [
        "active",
        "deferred",
        "pending",
        "complete"
      ],
      "statesRequiringExecutionStart": [
        "active",
        "complete"
      ],
      "statesRequiringCompletionTime": [
        "complete"
      ],
      "queueScopeRequiredWhenObjectiveSet": [
        "in_scope",
        "acceptance_criteria"
      ],
      "statesRequiringClaimLease": [
        "active"
      ],
      "claimLeaseRequiredFields": [
        "claimed_by",
        "claimed_at",
        "lease_expires_at"
      ],
      "statesRequiringCompletionEvidence": [
        "complete"
      ],
      "completionEvidenceRequiredFields": [
        "outputs",
        "evidence",
        "resolution_summary"
      ],
      "archiveOnItemStates": [
        "complete"
      ],
      "archiveQueueStatesTriggeringFeatureArchive": [
        "complete"
      ],
      "forbidArchivedStatesInHotQueue": true,
      "archiveIndexRequiredFields": [
        "version",
        "last_updated",
        "items"
      ],
      "archiveIndexRequiredItemFields": [
        "archive_key",
        "kind",
        "feature_id",
        "archived_at",
        "archive_ref"
      ],
      "sessionBriefFreshnessFailureMode": "fail",
      "sessionBriefRequired": true,
      "sessionBriefMustPostdateQueueAndArchive": true,
      "preflightQueueQualityFailureMode": "fail",
      "preflightQueueQualityFailureRules": [
        "missingTopLevelDeferredReason",
        "missingTopLevelScope",
        "missingTopLevelAcceptance",
        "deferredItemIds",
        "activeOrCompleteMissingStartIds",
        "completeItemMissingCompletedAtIds",
        "completeItemMissingEvidenceIds"
      ],
      "completionEvidenceVerificationPrefix": "verify:"
    },
    "workspaceLayout": {
      "canonicalRepoRoot": ".",
      "canonicalAgentsRoot": "../agents-workfiles/soundspan",
      "worktreesRoot": "../soundspan.worktrees",
      "enforceWorktreeRoot": true,
      "requireSemanticMergeForAgents": true,
      "requireSemanticMergeOnAgentsEdit": true,
      "requireWorktreeAgentsSymlink": true,
      "localAgentsPath": ".agents",
      "requireLocalAgentsSymlink": true
    },
    "canonicalRules": {
      "file": ".agents-config/contracts/rules/canonical-ruleset.json",
      "overrideSchemaFile": ".agents-config/agent-overrides/rule-overrides.schema.json",
      "optionalOverrideFile": ".agents-config/agent-overrides/rule-overrides.json",
      "verifyScript": ".agents-config/tools/rules/verify-canonical-ruleset.mjs",
      "npmVerifyScriptName": "rules:canonical:verify",
      "npmVerifyScriptCommand": "node .agents-config/tools/rules/verify-canonical-ruleset.mjs --check",
      "npmSyncScriptName": "rules:canonical:sync",
      "npmSyncScriptCommand": "node .agents-config/tools/rules/verify-canonical-ruleset.mjs --write",
      "contextIndexSection": "canonicalRules",
      "contextIndexVerifyCommandKey": "canonicalRulesVerify",
      "contextIndexSyncCommandKey": "canonicalRulesSync",
      "profiles": [
        "base"
      ],
      "enabled": true
    },
    "ruleCatalog": {
      "file": ".agents-config/docs/AGENT_RULES.md",
      "requiredIds": [
        "rule_startup_read_order",
        "rule_context_index_usage",
        "rule_execution_queue_required",
        "rule_queue_plan_before_execution",
        "rule_queue_single_source_of_truth",
        "rule_queue_scoped_context_read",
        "rule_queue_archive_on_complete",
        "rule_plan_machine_contract_required",
        "rule_plan_step_reference_required",
        "rule_plan_non_goals_status_gate",
        "rule_plan_placeholder_deliverables_forbidden",
        "rule_plan_complete_step_summary_required",
        "rule_plan_status_coherence_required",
        "rule_scope_tight_no_overbroad_refactor",
        "rule_hybrid_machine_human_contract",
        "rule_policy_sync_required",
        "rule_continuity_required",
        "rule_post_compaction_rebootstrap",
        "rule_repo_index_preflight_gate",
        "rule_context_index_drift_guard",
        "rule_canonical_ruleset_contract_required",
        "rule_local_rule_overrides_contract_required",
        "rule_managed_files_known_overrides_only",
        "rule_managed_files_canonical_contract_required",
        "rule_canonical_agents_root",
        "rule_worktree_root_required",
        "rule_agents_semantic_merge_required",
        "rule_tdd_default",
        "rule_coverage_default_100",
        "rule_scope_completeness_gate",
        "rule_feature_index_required",
        "rule_test_matrix_required",
        "rule_release_notes_template_required",
        "rule_release_notes_changelog_source_required",
        "rule_logging_contract_required",
        "orch_hybrid_instruction_contract",
        "orch_scope_tightness",
        "orch_machine_payload_authoritative",
        "orch_delegate_substantive_work",
        "orch_operator_subagent_default",
        "orch_subagent_delegation_required_when_possible",
        "orch_human_nuance_addendum",
        "orch_atomic_task_delegation",
        "orch_dual_channel_result_envelope",
        "orch_orchestrator_coordination_only",
        "orch_release_idle_subagents_required",
        "orch_default_cli_routing",
        "orch_unconfirmed_unknowns",
        "orch_atomic_single_objective_scope",
        "orch_single_orchestrator_authority",
        "orch_concise_subagent_briefs",
        "orch_spec_refined_plan_verbosity",
        "orch_codex_model_default",
        "orch_claude_model_default",
        "rule_route_map_required",
        "rule_domain_readmes_required",
        "rule_jsdoc_coverage_required",
        "rule_openapi_endpoint_docs_required"
      ]
    },
    "orchestratorSubagent": {
      "machinePayloadRequiredFields": [
        "task_id",
        "orchestrator_id",
        "objective",
        "inputs",
        "constraints",
        "acceptance_criteria",
        "deliverables",
        "verification",
        "atomic_scope",
        "context_budget"
      ],
      "resultEnvelopeRequiredFields": [
        "status",
        "outputs",
        "evidence",
        "unresolved_questions",
        "concise_summary"
      ],
      "topology": {
        "singleOrchestratorOnly": true,
        "allowSubagentDelegation": false
      },
      "subagentDelegationRequiredWhenPossible": true,
      "idleSubagentReleaseRequired": true,
      "idleSubagentMaxIdleMinutes": 15,
      "verbosityBudgets": {
        "subagentObjectiveMaxWords": 32,
        "subagentInputContextMaxWords": 200,
        "subagentSummaryMaxWords": 120,
        "specOutlineMaxWords": 220,
        "refinedSpecMaxWords": 420,
        "implementationTaskMaxWords": 160
      },
      "defaultModelRouting": {
        "orchestrator": "gpt-5.3-codex",
        "subagent": "gpt-5.3-codex",
        "lowRiskLoop": "gpt-5.3-codex-spark"
      },
      "defaultReasoningEffortRouting": {
        "orchestrator": "xhigh",
        "subagent": "high",
        "lowRiskLoop": "medium"
      },
      "lowRiskSparkPolicy": {
        "allowedTaskClasses": [
          "single_file_edit",
          "grep_triage",
          "draft_rewrite"
        ],
        "explicitVerificationCommandsRequired": true,
        "minimumVerificationCommands": 1,
        "requiredVerificationCommands": [
          "node .agents-config/scripts/enforce-agent-policies.mjs"
        ],
        "requiredEvidencePrefix": "verify:"
      },
      "claudeModelRouting": {
        "orchestrator": "claude-opus-4-6",
        "subagent": "claude-opus-4-6",
        "alternativeSubagent": "claude-sonnet-4-6",
        "lowRiskLoop": "claude-haiku-4-5"
      },
      "claudeDelegationToCodex": {
        "preferredMethod": "codex_exec",
        "methods": {
          "codex_exec": "codex exec -p \"<prompt>\"",
          "codex_interactive": "codex"
        },
        "guidance": "Use codex exec for fire-and-forget atomic tasks; use interactive codex session only when iterative conversation is needed."
      },
      "defaultCliRouting": {
        "codex": "codex",
        "claude": "claude"
      },
      "rules": [
        {
          "id": "orch_hybrid_instruction_contract",
          "statement": "Use a hybrid instruction contract: machine-readable payload plus concise human-readable intent/nuance."
        },
        {
          "id": "orch_scope_tightness",
          "statement": "Keep delegated work and resulting diffs tightly scoped to the user request; no overbroad refactors unless explicitly requested."
        },
        {
          "id": "orch_machine_payload_authoritative",
          "statement": "Treat the machine-readable payload as authoritative for execution; resolve conflicts with prose before proceeding."
        },
        {
          "id": "orch_delegate_substantive_work",
          "statement": "Preserve orchestrator context by delegating substantive discovery/investigation and implementation tasks whenever delegation is feasible."
        },
        {
          "id": "orch_operator_subagent_default",
          "statement": "Whenever possible, delegate discovery and implementation work to subagents; direct single-agent execution is restricted to trivial coordination/meta tasks."
        },
        {
          "id": "orch_subagent_delegation_required_when_possible",
          "statement": "Treat subagent delegation as mandatory whenever delegation is feasible, including investigation/discovery and implementation execution."
        },
        {
          "id": "orch_human_nuance_addendum",
          "statement": "When nuances are not fully captured by machine-readable fields, include concise human-language addenda."
        },
        {
          "id": "orch_atomic_task_delegation",
          "statement": "Delegate work in strict atomic task slices so each subagent receives a concrete objective with explicit inputs, acceptance criteria, and verification steps."
        },
        {
          "id": "orch_dual_channel_result_envelope",
          "statement": "Require subagent output in two channels: machine-readable result envelope plus concise human-readable summary."
        },
        {
          "id": "orch_orchestrator_coordination_only",
          "statement": "Limit orchestrator direct execution to coordination/meta tasks; if delegation is infeasible, record explicit rationale first."
        },
        {
          "id": "orch_release_idle_subagents_required",
          "statement": "Release/close subagents immediately once they are complete or no longer actively executing delegated work."
        },
        {
          "id": "orch_default_cli_routing",
          "statement": "Default subagent orchestration mapping is Codex agents via `codex` CLI and Claude agents via `claude` CLI unless user-overridden."
        },
        {
          "id": "orch_unconfirmed_unknowns",
          "statement": "Mark unknowns explicitly as `UNCONFIRMED` and fail fast on missing required fields."
        },
        {
          "id": "orch_atomic_single_objective_scope",
          "statement": "Each delegated subagent task must target exactly one concrete objective with explicit atomic_scope boundaries; split multi-objective requests into separate tasks."
        },
        {
          "id": "orch_single_orchestrator_authority",
          "statement": "Use exactly one orchestrator context owner per session; subagents execute delegated work and must not recursively orchestrate."
        },
        {
          "id": "orch_concise_subagent_briefs",
          "statement": "Keep subagent machine payloads and human addenda concise, bounded by configured verbosity budgets."
        },
        {
          "id": "orch_spec_refined_plan_verbosity",
          "statement": "Apply concise verbosity budgets across spec outline, refined spec, and detailed implementation plan artifacts."
        },
        {
          "id": "orch_codex_model_default",
          "statement": "Default model routing is role/risk-based: orchestrator uses `gpt-5.3-codex` with `xhigh`, subagents use `gpt-5.3-codex` with `high`, and Spark is reserved for low-risk loops with explicit verification commands."
        },
        {
          "id": "orch_claude_model_default",
          "statement": "Claude model routing is role/risk-based: orchestrator uses `claude-opus-4-6`, subagents use `claude-opus-4-6` (or `claude-sonnet-4-6` for lighter tasks), and `claude-haiku-4-5` is reserved for low-risk loops. Claude orchestrators may delegate to Codex subagents via `codex exec`."
        }
      ],
      "delegationForDiscoveryRequiredWhenPossible": true,
      "delegationForImplementationRequiredWhenPossible": true,
      "strictAtomicTaskBriefsRequired": true,
      "closeSubagentOnCompletionRequired": true
    },
    "routeMap": {
      "file": ".agents-config/docs/ROUTE_MAP.md",
      "generatorScript": ".agents-config/tools/docs/generate-route-map.mjs",
      "npmGenerateScriptName": "route-map:generate",
      "npmGenerateScriptCommand": "node .agents-config/tools/docs/generate-route-map.mjs --write",
      "npmVerifyScriptName": "route-map:verify",
      "npmVerifyScriptCommand": "node .agents-config/tools/docs/generate-route-map.mjs --check",
      "requiredSections": [
        "# Route Map",
        "## Backend API Endpoint Map",
        "## Frontend Page Route Map",
        "## Frontend API Route Handler Map"
      ],
      "profiles": [
        "node-web"
      ],
      "enabled": true
    },
    "domainReadmes": {
      "generatorScript": ".agents-config/tools/docs/generate-domain-readmes.mjs",
      "npmGenerateScriptName": "domain-readmes:generate",
      "npmGenerateScriptCommand": "node .agents-config/tools/docs/generate-domain-readmes.mjs --write",
      "npmVerifyScriptName": "domain-readmes:verify",
      "npmVerifyScriptCommand": "node .agents-config/tools/docs/generate-domain-readmes.mjs --check",
      "requiredFiles": [
        "backend/src/routes/README.md",
        "backend/src/services/README.md",
        "frontend/features/README.md"
      ],
      "requiredSection": "## Start Here",
      "frontendFeatureRoot": "frontend/features",
      "profiles": [
        "node-web"
      ],
      "enabled": true
    },
    "jsdocCoverage": {
      "file": ".agents-config/docs/JSDOC_COVERAGE.md",
      "generatorScript": ".agents-config/tools/docs/generate-jsdoc-coverage.mjs",
      "npmGenerateScriptName": "jsdoc-coverage:generate",
      "npmGenerateScriptCommand": "node .agents-config/tools/docs/generate-jsdoc-coverage.mjs --write",
      "npmVerifyScriptName": "jsdoc-coverage:verify",
      "npmVerifyScriptCommand": "node .agents-config/tools/docs/generate-jsdoc-coverage.mjs --check",
      "requiredSections": [
        "# JSDoc Coverage Baseline",
        "## Coverage Summary",
        "## Missing Exported Symbols (Top 250)"
      ],
      "profiles": [
        "node-web"
      ],
      "enabled": true,
      "minimumTotalCoveragePercent": 36.1,
      "maximumMissingExportedSymbols": 432
    },
    "openapiCoverage": {
      "file": ".agents-config/docs/OPENAPI_COVERAGE.md",
      "generatorScript": ".agents-config/tools/docs/generate-openapi-coverage.mjs",
      "npmGenerateScriptName": "openapi-coverage:generate",
      "npmGenerateScriptCommand": "node .agents-config/tools/docs/generate-openapi-coverage.mjs --write",
      "npmVerifyScriptName": "openapi-coverage:verify",
      "npmVerifyScriptCommand": "node .agents-config/tools/docs/generate-openapi-coverage.mjs --check",
      "contextIndexGenerateCommandKey": "openapiCoverageGenerate",
      "contextIndexVerifyCommandKey": "openapiCoverageVerify",
      "contextIndexCoverageFileCommandKey": "openapiCoverageFile",
      "requiredSections": [
        "# OpenAPI Endpoint Coverage Baseline",
        "## Coverage Summary",
        "## Missing OpenAPI Endpoint Docs"
      ],
      "profiles": [
        "node-web"
      ],
      "enabled": true,
      "minimumTotalCoveragePercent": 90.3,
      "maximumMissingEndpoints": 34,
      "maximumUndocumentableEndpoints": 65
    },
    "loggingStandards": {
      "standardsFile": ".agents-config/docs/LOGGING_STANDARDS.md",
      "verifyScript": ".agents-config/scripts/verify-logging-compliance.mjs",
      "baselineFile": ".agents-config/policies/logging-compliance-baseline.json",
      "npmGenerateScriptName": "logging:compliance:generate",
      "npmGenerateScriptCommand": "node .agents-config/scripts/verify-logging-compliance.mjs --write-baseline",
      "npmVerifyScriptName": "logging:compliance:verify",
      "npmVerifyScriptCommand": "node .agents-config/scripts/verify-logging-compliance.mjs --check",
      "contextIndexGenerateCommandKey": "loggingComplianceGenerate",
      "contextIndexVerifyCommandKey": "loggingComplianceVerify",
      "contextIndexStandardsFileCommandKey": "loggingStandardsFile",
      "requiredSections": [
        "# Logging Standards",
        "## Shared Principles",
        "## Frontend Contract",
        "## Backend Contract",
        "## Python Sidecar Contract",
        "## Enforcement",
        "## Migration to 100% Coverage"
      ],
      "requiredSnippets": [
        "frontend/lib/logger.ts",
        "backend/src/utils/logger.ts",
        "services/common/logging_utils.py",
        "Everything in the project should be logged appropriately",
        "npm run logging:compliance:verify"
      ],
      "profiles": [
        "node-web"
      ],
      "enabled": true
    },
    "releaseVersion": {
      "packageTargets": [
        {
          "label": "root",
          "dir": ".",
          "expectedName": "soundspan"
        }
      ],
      "chartDir": "charts/soundspan",
      "releaseImageSections": [
        "app"
      ]
    },
    "profiles": {
      "availableProfiles": [
        "base",
        "node-web"
      ],
      "activeProfiles": [
        "base",
        "node-web"
      ]
    },
    "managedFilesCanonical": {
      "manifestFile": ".agents-config/agent-managed.json",
      "manifestTemplateFile": ".agents-config/tools/bootstrap/managed-files.template.json",
      "canonicalContractField": "canonical_contract",
      "defaultAuthority": "template",
      "allowedAuthorities": [
        "template",
        "project"
      ],
      "overrideMode": "explicit_allowlist",
      "overrideReservedPaths": [
        "rule-overrides.schema.json",
        "rule-overrides.json",
        "README.md",
        ".gitkeep"
      ],
      "entryAllowOverrideField": "allow_override",
      "entryAuthorityField": "authority",
      "checkCommand": "npm run agent:managed -- --mode check",
      "fixCommand": "npm run agent:managed -- --fix --recheck",
      "contextIndexSection": "managedFilesCanonical",
      "contextIndexCheckCommandKey": "agentManaged",
      "contextIndexFixCommandKey": "agentManagedFix",
      "profiles": [
        "base"
      ],
      "enabled": true,
      "npmScriptName": "agent:managed",
      "npmScriptCommand": "node .agents-config/tools/bootstrap/agent-managed-files.mjs"
    }
  },
  "checks": {
    "requiredTextSnippets": [
      {
        "file": "AGENTS.md",
        "snippets": [
          "## Required Startup Order",
          ".agents-config/docs/AGENT_RULES.md",
          ".agents-config/docs/CONTEXT_INDEX.json",
          ".agents-config/docs/AGENT_CONTEXT.md",
          ".agents/EXECUTION_QUEUE.json",
          "npm run agent:preflight",
          "## Canonical Sources and Precedence",
          "Machine-readable canonical policy: `.agents-config/policies/agent-governance.json`",
          "Canonical rule catalog: `.agents-config/contracts/rules/canonical-ruleset.json`",
          "Local rule override schema: `.agents-config/agent-overrides/rule-overrides.schema.json`",
          "## Session Context Artifacts",
          "Shared queue authority for orchestrator and subagents: `.agents/EXECUTION_QUEUE.json` (single source of truth)",
          "## Orchestrator/Subagent Contract Pointer",
          "## Policy-as-Code Enforcement",
          "npm run rules:canonical:verify",
          ".agents-config/docs/FEATURE_INDEX.json",
          ".agents-config/docs/TEST_MATRIX.md",
          ".agents-config/docs/ROUTE_MAP.md",
          ".agents-config/docs/JSDOC_COVERAGE.md",
          ".agents-config/docs/OPENAPI_COVERAGE.md",
          ".agents-config/docs/LOGGING_STANDARDS.md",
          "must delegate discovery and implementation work to subagents whenever possible",
          "Subagent assignments must be strict and atomic with clear objective, context, acceptance criteria, and verification expectations.",
          "Release/close subagents immediately once they are complete or no longer actively executing delegated work."
        ]
      },
      {
        "file": ".agents-config/docs/AGENT_RULES.md",
        "snippets": [
          "## Rule ID Catalog (Machine Cross-Reference)",
          "`rule_context_index_usage`",
          "`rule_execution_queue_required`",
          "`rule_canonical_ruleset_contract_required`",
          "`rule_canonical_agents_root`",
          "`rule_worktree_root_required`",
          "`rule_logging_contract_required`",
          "`rule_openapi_endpoint_docs_required`",
          "### Accuracy, Recency, and Sourcing (Required)",
          "### Context7 MCP and Web Search Policy",
          "### Container-First Policy (Required)",
          "### Session Artifact Contracts (Required)",
          "### CONTINUITY.md Contract (Required)",
          "### Post-Compaction Startup Checklist (Required)",
          "### Definition of Done",
          "strict atomic subagent tasks with explicit objective, inputs, acceptance criteria, and verification",
          "Idle or completed subagents must be released/closed immediately",
          "Delegate discovery and implementation work to subagents whenever possible"
        ]
      },
      {
        "file": ".agents-config/docs/AGENT_CONTEXT.md",
        "snippets": [
          "Canonical machine-readable context map: `.agents-config/docs/CONTEXT_INDEX.json`",
          "## Project Overview",
          "## Architecture",
          "## Tech Stack",
          "## Project Structure",
          "## Key Conventions",
          "## Reuse and Consolidation Atlas",
          "## Fork Documentation Maintenance",
          "## Full-Stack Delivery Gates",
          "## Database",
          "## Streaming Integration",
          "## Testing",
          "## Local Testing Bootstrap",
          "## Common Tasks",
          "Treat `CHANGELOG.md` as the release-notes source of truth.",
          "Keep `.agents-config/docs/FEATURE_INDEX.json`, `.agents-config/docs/TEST_MATRIX.md`, `.agents-config/docs/ROUTE_MAP.md`, `.agents-config/docs/JSDOC_COVERAGE.md`, `.agents-config/docs/OPENAPI_COVERAGE.md`, and `.agents-config/docs/LOGGING_STANDARDS.md` current."
        ]
      },
      {
        "file": ".agents-config/docs/RELEASE_NOTES_TEMPLATE.md",
        "snippets": [
          "# soundspan {{VERSION}} Release Notes",
          "Helm chart repository: `https://soundspan.github.io/soundspan`",
          "Helm chart name: `soundspan`",
          "Helm chart reference: `soundspan/soundspan`",
          "helm repo add soundspan https://soundspan.github.io/soundspan",
          "helm upgrade --install soundspan soundspan/soundspan --version {{VERSION}}"
        ]
      },
      {
        "file": ".agents-config/docs/README.md",
        "profiles": [
          "node-web"
        ],
        "snippets": [
          "[`FEATURE_INDEX.json`](FEATURE_INDEX.json)",
          "[`TEST_MATRIX.md`](TEST_MATRIX.md)",
          "[`ROUTE_MAP.md`](ROUTE_MAP.md)",
          "[`JSDOC_COVERAGE.md`](JSDOC_COVERAGE.md)",
          "[`OPENAPI_COVERAGE.md`](OPENAPI_COVERAGE.md)",
          "[`LOGGING_STANDARDS.md`](LOGGING_STANDARDS.md)",
          "[`../backend/src/routes/README.md`](../backend/src/routes/README.md)",
          "[`../backend/src/services/README.md`](../backend/src/services/README.md)",
          "[`../frontend/features/README.md`](../frontend/features/README.md)"
        ]
      },
      {
        "file": ".agents-config/scripts/agent-queue-lifecycle.mjs",
        "snippets": [
          "function moveFeaturePlanDirectory(queueFile, featureId)",
          ".agents/plans/archived/",
          "rewrote",
          "queue plan_ref entries"
        ]
      },
      {
        "file": ".github/workflows/pr-checks.yml",
        "snippets": [
          "Policy as Code",
          "npm run policy:check:ci"
        ]
      },
      {
        "file": "package.json",
        "snippets": [
          "\"agent:queue:open\"",
          "\"agent:queue:start\"",
          "\"agent:queue:complete\"",
          "\"agent:queue:close-feature\"",
          "\"rules:canonical:verify\"",
          "\"rules:canonical:sync\"",
          "\"feature-index:verify\"",
          "\"release:prepare\"",
          "\"release:verify\"",
          "\"release:notes\"",
          "\"route-map:generate\"",
          "\"route-map:verify\"",
          "\"domain-readmes:generate\"",
          "\"domain-readmes:verify\"",
          "\"jsdoc-coverage:generate\"",
          "\"jsdoc-coverage:verify\"",
          "\"openapi-coverage:generate\"",
          "\"openapi-coverage:verify\"",
          "\"logging:compliance:generate\"",
          "\"logging:compliance:verify\"",
          "\"policy:check:ci\"",
          "\"release:contract:check\""
        ]
      }
    ],
    "requiredMarkdownSections": [
      {
        "file": "AGENTS.md",
        "sections": [
          "## Required Startup Order",
          "## Canonical Sources and Precedence",
          "## Session Context Artifacts",
          "## Orchestrator/Subagent Contract Pointer",
          "## Policy-as-Code Enforcement"
        ]
      },
      {
        "file": ".agents-config/docs/AGENT_RULES.md",
        "sections": [
          "## Rule ID Catalog (Machine Cross-Reference)",
          "## Global Operating Agreements (All LLMs)",
          "## Policy-as-Code Enforcement",
          "### Logging Standards Contract (Required)",
          "## LLM Continuity and Execution Discipline",
          "### CLI Worktree Parallelism (Required)",
          "### Orchestrator/Subagent Instruction Contract (Required)",
          "### Session Artifact Contracts (Required)",
          "### CONTINUITY.md Contract (Required)",
          "### Post-Compaction Startup Checklist (Required)",
          "### Definition of Done"
        ]
      },
      {
        "file": ".agents-config/docs/AGENT_CONTEXT.md",
        "sections": [
          "## Project Overview",
          "## Architecture",
          "## Tech Stack",
          "## Project Structure",
          "## Key Conventions",
          "## Reuse and Consolidation Atlas",
          "## Fork Documentation Maintenance",
          "## Full-Stack Delivery Gates",
          "## Database",
          "## Streaming Integration",
          "## Testing",
          "## Local Testing Bootstrap",
          "## Common Tasks"
        ]
      },
      {
        "file": ".agents-config/docs/RELEASE_NOTES_TEMPLATE.md",
        "sections": [
          "## Release Summary",
          "## Fixed",
          "## Added",
          "## Changed",
          "## Admin/Operations",
          "## Deployment and Distribution",
          "## Breaking Changes",
          "## Known Issues",
          "## Compatibility and Migration",
          "## Full Changelog"
        ]
      },
      {
        "file": ".agents-config/docs/TEST_MATRIX.md",
        "profiles": [
          "node-web"
        ],
        "sections": [
          "# Test Matrix",
          "## Usage Rule",
          "## Fast Commands",
          "## Feature-to-Test Map",
          "## Update Triggers",
          "## Verification Workflow"
        ]
      },
      {
        "file": ".agents-config/docs/JSDOC_COVERAGE.md",
        "profiles": [
          "node-web"
        ],
        "sections": [
          "# JSDoc Coverage Baseline",
          "## Coverage Summary",
          "## Missing Exported Symbols (Top 250)"
        ]
      },
      {
        "file": ".agents-config/docs/OPENAPI_COVERAGE.md",
        "profiles": [
          "node-web"
        ],
        "sections": [
          "# OpenAPI Endpoint Coverage Baseline",
          "## Coverage Summary",
          "## Missing OpenAPI Endpoint Docs"
        ]
      },
      {
        "file": ".agents/CONTINUITY.md",
        "optional": false,
        "sections": [
          "## [PLANS]",
          "## [DECISIONS]",
          "## [PROGRESS]",
          "## [DISCOVERIES]",
          "## [OUTCOMES]"
        ]
      },
      {
        "file": ".agents-config/docs/ROUTE_MAP.md",
        "profiles": [
          "node-web"
        ],
        "sections": [
          "# Route Map",
          "## Backend API Endpoint Map",
          "## Frontend Page Route Map",
          "## Frontend API Route Handler Map"
        ]
      },
      {
        "file": "backend/src/routes/README.md",
        "profiles": [
          "node-web"
        ],
        "sections": [
          "# Backend Routes",
          "## Start Here",
          "## Mounted Route Modules",
          "## Update Rule"
        ]
      },
      {
        "file": "backend/src/services/README.md",
        "profiles": [
          "node-web"
        ],
        "sections": [
          "# Backend Services",
          "## Start Here",
          "## Service Modules",
          "## Update Rule"
        ]
      },
      {
        "file": "frontend/features/README.md",
        "profiles": [
          "node-web"
        ],
        "sections": [
          "# Frontend Features",
          "## Start Here",
          "## Feature Domains",
          "## Update Rule"
        ]
      }
    ],
    "requiredSequenceSnippets": [
      {
        "file": ".agents-config/docs/AGENT_RULES.md",
        "sequence": [
          "1. Re-read `AGENTS.md`, `.agents-config/docs/AGENT_RULES.md`, `.agents-config/docs/CONTEXT_INDEX.json`, and `.agents-config/docs/AGENT_CONTEXT.md`.",
          "2. Confirm branch + workspace state (`git rev-parse --abbrev-ref HEAD`, `git status --short`).",
          "3. Load `.agents/EXECUTION_QUEUE.json` and `.agents/CONTINUITY.md`; both are required startup artifacts.",
          "4. Run `npm run agent:preflight` to regenerate `.agents/SESSION_BRIEF.json`.",
          "5. Re-confirm active user scope, exclusions, and acceptance criteria from the latest user instruction.",
          "6. Publish a short resume plan naming the exact next atomic task before editing code."
        ]
      },
      {
        "file": ".agents-config/docs/RELEASE_NOTES_TEMPLATE.md",
        "sequence": [
          "## Release Summary",
          "## Fixed",
          "## Added",
          "## Changed",
          "## Admin/Operations",
          "## Deployment and Distribution",
          "## Breaking Changes",
          "## Known Issues",
          "## Compatibility and Migration",
          "## Full Changelog"
        ]
      }
    ],
    "continuityEntryFormat": {
      "file": ".agents/CONTINUITY.md",
      "optional": false,
      "sectionHeaders": [
        "## [PLANS]",
        "## [DECISIONS]",
        "## [PROGRESS]",
        "## [DISCOVERIES]",
        "## [OUTCOMES]"
      ],
      "entryRegex": "^- \\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}(?::\\d{2})?Z \\[(USER|CODE|TOOL|ASSUMPTION|MILESTONE)\\] .+"
    },
    "disallowedTrackedPathPrefixes": [
      {
        "prefix": ".agents/plans/",
        "message": ".agents/plans/** is local-only context and must not be committed."
      },
      {
        "prefix": ".agents/",
        "message": ".agents/** is local-only context and must not be committed."
      },
      {
        "prefix": ".worktrees/",
        "message": ".worktrees/** is deprecated legacy workspace location; use ../<repo-name>.worktrees."
      }
    ],
    "forbiddenTextPatterns": [
      {
        "id": "forbid_private_key_material",
        "pattern": "-----BEGIN (?:RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----",
        "message": "Private key material must not be committed to the repository.",
        "excludePaths": []
      },
      {
        "id": "forbid_github_pat_token",
        "pattern": "gh[pousr]_[A-Za-z0-9]{30,255}",
        "message": "Potential GitHub token detected in tracked content; remove secrets from source control.",
        "excludePaths": []
      }
    ]
  }
}
